{"ast":null,"code":"var _jsxFileName = \"/Users/giuseppebondi/Documents/GitHub/platform/src/components/EmuSchermo.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport \"./EmuSchermo.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BUTTONS = {\n  A: 1,\n  B: 2,\n  START: 3,\n  SELECT: 4,\n  LEFT: 7,\n  RIGHT: 8\n};\nconst LEVEL = [{\n  type: \"p\",\n  height: 20,\n  posStartX: 30,\n  posEndX: 40\n}, {\n  type: \"p\",\n  height: 35,\n  posStartX: 50,\n  posEndX: 60\n}, {\n  type: \"p\",\n  height: 60,\n  posStartX: 70,\n  posEndX: 80\n}];\nfunction EmuSchermo({\n  pressedButtons\n}) {\n  _s();\n  const ballSize = 5;\n  const horizontalAcceleration = 0.2;\n  const maxHorizontalSpeed = 2;\n  const friction = 0.1;\n  const jumpVelocity = 6;\n  const gravity = -0.5;\n  const [ball, setBall] = useState({\n    x: 50 - ballSize / 2,\n    y: 0,\n    vx: 0,\n    vy: 0\n  });\n  const pressedButtonsRef = useRef(pressedButtons);\n  useEffect(() => {\n    pressedButtonsRef.current = pressedButtons;\n  }, [pressedButtons]);\n  const animationFrameId = useRef(null);\n  useEffect(() => {\n    const update = () => {\n      setBall(prev => {\n        let {\n          x,\n          y,\n          vx,\n          vy\n        } = prev;\n        const currentPressedButtons = pressedButtonsRef.current || {};\n\n        // Gestione input orizzontale\n        if (currentPressedButtons[BUTTONS.LEFT]) vx -= horizontalAcceleration;\n        if (currentPressedButtons[BUTTONS.RIGHT]) vx += horizontalAcceleration;\n        if (!currentPressedButtons[BUTTONS.LEFT] && !currentPressedButtons[BUTTONS.RIGHT]) {\n          vx = vx > 0 ? Math.max(vx - friction, 0) : Math.min(vx + friction, 0);\n        }\n        vx = Math.min(Math.max(vx, -maxHorizontalSpeed), maxHorizontalSpeed);\n\n        // Salto solo se a terra o su piattaforma\n        const isOnGroundOrPlatform = prev.y === 0 || LEVEL.some(p => p.height === prev.y);\n        if (currentPressedButtons[BUTTONS.A] && isOnGroundOrPlatform) {\n          vy = jumpVelocity;\n        }\n        vy += gravity;\n        let newY = y + vy;\n        let newX = x + vx;\n\n        // Collisioni con piattaforme\n        const sortedPlatforms = [...LEVEL].sort((a, b) => b.height - a.height);\n        let collided = false;\n        for (const platform of sortedPlatforms) {\n          const platformSurface = platform.height + 2; // Altezza superficie (2% è lo spessore della piattaforma)\n          const horizontalOverlap = newX < platform.posEndX && newX + ballSize > platform.posStartX;\n\n          // Calcoliamo i limiti verticali della pallina\n          const prevBallBottom = prev.y;\n          const newBallBottom = newY;\n\n          // Verifichiamo se sta attraversando la piattaforma dall'alto verso il basso\n          const wasAbove = prevBallBottom > platformSurface;\n          const nowOnOrBelow = newBallBottom <= platformSurface;\n          const isFalling = vy < 0;\n          if (horizontalOverlap && wasAbove && nowOnOrBelow && isFalling) {\n            // Posizioniamo la pallina esattamente sulla superficie della piattaforma\n            newY = platformSurface;\n            vy = 0;\n            collided = true;\n            break;\n          }\n        }\n\n        // Collisione con il terreno solo se non abbiamo colliso con piattaforme\n        if (!collided && newY < 0) {\n          newY = 0;\n          vy = 0;\n        }\n\n        // Collisione con il terreno\n        if (!collided && newY < 0) {\n          newY = 0;\n          vy = 0;\n        }\n\n        // Clamping orizzontale\n        newX = Math.max(0, Math.min(newX, 100 - ballSize));\n        return {\n          x: newX,\n          y: newY,\n          vx,\n          vy\n        };\n      });\n      animationFrameId.current = requestAnimationFrame(update);\n    };\n    animationFrameId.current = requestAnimationFrame(update);\n    return () => cancelAnimationFrame(animationFrameId.current);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"emu-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ball\",\n      style: {\n        left: `${ball.x}%`,\n        bottom: `${ball.y}%`,\n        width: `${ballSize}%`,\n        height: `${ballSize + 2}%`\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), LEVEL.map((platform, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"platform\",\n      style: {\n        left: `${platform.posStartX}%`,\n        width: `${platform.posEndX - platform.posStartX}%`,\n        bottom: `${platform.height}%`,\n        height: \"5%\"\n      }\n    }, i, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n}\n_s(EmuSchermo, \"oG/LxqIYcykXTcc3OkmwwZ8XtJQ=\");\n_c = EmuSchermo;\nexport default EmuSchermo;\nvar _c;\n$RefreshReg$(_c, \"EmuSchermo\");","map":{"version":3,"names":["React","useState","useEffect","useRef","jsxDEV","_jsxDEV","BUTTONS","A","B","START","SELECT","LEFT","RIGHT","LEVEL","type","height","posStartX","posEndX","EmuSchermo","pressedButtons","_s","ballSize","horizontalAcceleration","maxHorizontalSpeed","friction","jumpVelocity","gravity","ball","setBall","x","y","vx","vy","pressedButtonsRef","current","animationFrameId","update","prev","currentPressedButtons","Math","max","min","isOnGroundOrPlatform","some","p","newY","newX","sortedPlatforms","sort","a","b","collided","platform","platformSurface","horizontalOverlap","prevBallBottom","newBallBottom","wasAbove","nowOnOrBelow","isFalling","requestAnimationFrame","cancelAnimationFrame","className","children","style","left","bottom","width","fileName","_jsxFileName","lineNumber","columnNumber","map","i","_c","$RefreshReg$"],"sources":["/Users/giuseppebondi/Documents/GitHub/platform/src/components/EmuSchermo.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport \"./EmuSchermo.css\";\n\nconst BUTTONS = {\n  A: 1,\n  B: 2,\n  START: 3,\n  SELECT: 4,\n  LEFT: 7,\n  RIGHT: 8,\n};\n\nconst LEVEL = [\n  { type: \"p\", height: 20, posStartX: 30, posEndX: 40 },\n  { type: \"p\", height: 35, posStartX: 50, posEndX: 60 },\n  { type: \"p\", height: 60, posStartX: 70, posEndX: 80 }\n];\n\nfunction EmuSchermo({ pressedButtons }) {\n  const ballSize = 5;\n  const horizontalAcceleration = 0.2;\n  const maxHorizontalSpeed = 2;\n  const friction = 0.1;\n  const jumpVelocity = 6;\n  const gravity = -0.5;\n\n  const [ball, setBall] = useState({\n    x: 50 - ballSize / 2,\n    y: 0,\n    vx: 0,\n    vy: 0,\n  });\n\n  const pressedButtonsRef = useRef(pressedButtons);\n  useEffect(() => {\n    pressedButtonsRef.current = pressedButtons;\n  }, [pressedButtons]);\n\n  const animationFrameId = useRef(null);\n\n  useEffect(() => {\n    const update = () => {\n      setBall((prev) => {\n        let { x, y, vx, vy } = prev;\n        const currentPressedButtons = pressedButtonsRef.current || {};\n\n        // Gestione input orizzontale\n        if (currentPressedButtons[BUTTONS.LEFT]) vx -= horizontalAcceleration;\n        if (currentPressedButtons[BUTTONS.RIGHT]) vx += horizontalAcceleration;\n\n        if (!currentPressedButtons[BUTTONS.LEFT] && !currentPressedButtons[BUTTONS.RIGHT]) {\n          vx = vx > 0 ? Math.max(vx - friction, 0) : Math.min(vx + friction, 0);\n        }\n\n        vx = Math.min(Math.max(vx, -maxHorizontalSpeed), maxHorizontalSpeed);\n\n        // Salto solo se a terra o su piattaforma\n        const isOnGroundOrPlatform = prev.y === 0 || LEVEL.some(p => p.height === prev.y);\n        if (currentPressedButtons[BUTTONS.A] && isOnGroundOrPlatform) {\n          vy = jumpVelocity;\n        }\n\n        vy += gravity;\n        let newY = y + vy;\n        let newX = x + vx;\n\n// Collisioni con piattaforme\nconst sortedPlatforms = [...LEVEL].sort((a, b) => b.height - a.height);\nlet collided = false;\n\nfor (const platform of sortedPlatforms) {\n    const platformSurface = platform.height + 2; // Altezza superficie (2% è lo spessore della piattaforma)\n    const horizontalOverlap = (\n        newX < platform.posEndX && \n        (newX + ballSize) > platform.posStartX\n    );\n    \n    // Calcoliamo i limiti verticali della pallina\n    const prevBallBottom = prev.y;\n    const newBallBottom = newY;\n    \n    // Verifichiamo se sta attraversando la piattaforma dall'alto verso il basso\n    const wasAbove = prevBallBottom > platformSurface;\n    const nowOnOrBelow = newBallBottom <= platformSurface;\n    const isFalling = vy < 0;\n\n    if (horizontalOverlap && wasAbove && nowOnOrBelow && isFalling) {\n        // Posizioniamo la pallina esattamente sulla superficie della piattaforma\n        newY = platformSurface;\n        vy = 0;\n        collided = true;\n        break;\n    }\n}\n\n// Collisione con il terreno solo se non abbiamo colliso con piattaforme\nif (!collided && newY < 0) {\n    newY = 0;\n    vy = 0;\n}\n\n        // Collisione con il terreno\n        if (!collided && newY < 0) {\n          newY = 0;\n          vy = 0;\n        }\n\n        // Clamping orizzontale\n        newX = Math.max(0, Math.min(newX, 100 - ballSize));\n\n        return { x: newX, y: newY, vx, vy };\n      });\n      animationFrameId.current = requestAnimationFrame(update);\n    };\n\n    animationFrameId.current = requestAnimationFrame(update);\n    return () => cancelAnimationFrame(animationFrameId.current);\n  }, []);\n\n  return (\n    <div className=\"emu-container\">\n      <div\n        className=\"ball\"\n        style={{\n          left: `${ball.x}%`,\n          bottom: `${ball.y}%`,\n          width: `${ballSize}%`,\n          height: `${ballSize + 2}%`,\n        }}\n      ></div>\n      {LEVEL.map((platform, i) => (\n        <div\n          key={i}\n          className=\"platform\"\n          style={{\n            left: `${platform.posStartX}%`,\n            width: `${platform.posEndX - platform.posStartX}%`,\n            bottom: `${platform.height}%`,\n            height: \"5%\",\n          }}\n        />\n      ))}\n    </div>\n  );\n}\n\nexport default EmuSchermo;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}